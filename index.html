<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pengumpulan Tugas Online</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Menggunakan font Inter sebagai default */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style untuk file input yang lebih menarik */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-button {
            border: 1px solid #E5E7EB;
            display: inline-block;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 0.375rem;
            background-color: white;
        }
        .file-input-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .file-name {
            margin-left: 10px;
            font-style: italic;
            color: #6B7280;
        }
        /* Style untuk tab navigasi aktif */
        .nav-tab.active {
            border-bottom-color: #FBBF24; /* yellow-400 */
            color: #92400E; /* yellow-800 */
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-yellow-50 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <!-- Halaman Login -->
        <div id="loginPage" class="w-full max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 space-y-6">
            <h2 class="text-2xl font-bold text-center text-yellow-900">Selamat Datang!</h2>
            <p class="text-center text-gray-500">Silakan masuk sebagai siswa atau guru.</p>
            <div>
                <label for="loginRole" class="block text-sm font-medium text-gray-700">Saya adalah seorang</label>
                <select id="loginRole" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500">
                    <option value="siswa">Siswa</option>
                    <option value="guru">Guru</option>
                </select>
            </div>
            <div id="guruLoginSection" class="hidden">
                <label for="namaGuru" class="block text-sm font-medium text-gray-700">Nama Guru</label>
                <input type="text" id="namaGuru" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500" placeholder="Masukkan nama lengkap Anda">
                <p id="guruLoginError" class="text-red-500 text-sm mt-1 hidden">Nama guru tidak terdaftar. Silakan coba lagi.</p>
            </div>
            <button id="loginButton" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 shadow-md">Masuk</button>
        </div>

        <!-- Kontainer Aplikasi Utama (Awalnya Tersembunyi) -->
        <div id="appContainer" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                <header class="mb-4">
                    <h1 class="text-3xl font-bold text-yellow-900 text-center">Portal Pengumpulan Tugas</h1>
                    <p class="text-center text-gray-500 mt-1">Platform untuk mengelola tugas siswa dan guru.</p>
                </header>

                <!-- Pilihan Role Pengguna (Siswa/Guru) - Dikelola oleh JS setelah login -->
                <div class="mb-4 flex justify-end items-center space-x-2">
                    <label for="userRole" class="text-sm font-medium">Anda masuk sebagai:</label>
                    <select id="userRole" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition" disabled>
                        <option value="siswa">Siswa</option>
                        <option value="guru">Guru</option>
                    </select>
                </div>
                
                <!-- Navigasi Halaman -->
                <nav class="border-b border-gray-200 mb-6">
                    <div class="flex space-x-4">
                        <button id="navPage1" class="nav-tab py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-yellow-700 transition-colors">
                            Halaman 1: Formulir Tugas
                        </button>
                        <button id="navPage2" class="nav-tab py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-yellow-700 transition-colors">
                            Halaman 2: Rekap & Feedback
                        </button>
                    </div>
                </nav>

                <main>
                    <!-- Halaman 1: Form Pengumpulan Tugas (Untuk Siswa) -->
                    <div id="page1">
                        <div id="formContainer">
                            <h2 class="text-xl font-semibold mb-4 text-yellow-800 border-b pb-2">Formulir Pengumpulan Tugas</h2>
                            <form id="submissionForm" class="space-y-4">
                                <div>
                                    <label for="namaSiswa" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                                    <input type="text" id="namaSiswa" name="namaSiswa" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500" required>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="kelas" class="block text-sm font-medium text-gray-700">Kelas</label>
                                        <input type="text" id="kelas" name="kelas" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500" required>
                                    </div>
                                    <div>
                                        <label for="mapel" class="block text-sm font-medium text-gray-700">Mata Pelajaran</label>
                                        <input type="text" id="mapel" name="mapel" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Upload File Tugas</label>
                                    <div class="mt-1 flex items-center">
                                        <div class="file-input-wrapper">
                                            <button type="button" class="file-input-button">Pilih File</button>
                                            <input type="file" id="fileTugas" name="fileTugas" required>
                                        </div>
                                        <span id="fileName" class="file-name">Belum ada file dipilih</span>
                                    </div>
                                </div>
                                <div>
                                    <label for="kesimpulan" class="block text-sm font-medium text-gray-700">Kesimpulan Pelajaran</label>
                                    <textarea id="kesimpulan" name="kesimpulan" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500" placeholder="Tuliskan apa yang Anda pelajari dari tugas ini..."></textarea>
                                </div>
                                <div class="pt-2">
                                     <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 shadow-md">
                                        Kumpulkan Tugas
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div id="deadlineMessage" class="hidden text-center p-6 bg-red-100 text-red-700 rounded-lg">
                            <h3 class="font-bold text-lg">Waktu Habis!</h3>
                            <p>Maaf, batas waktu pengumpulan tugas telah berakhir. Anda tidak dapat mengumpulkan tugas lagi.</p>
                        </div>
                    </div>

                    <!-- Halaman 2: Komentar Guru & Rekapitulasi -->
                    <div id="page2" class="hidden">
                        <div class="space-y-6">
                            <!-- Batas Waktu Pengumpulan -->
                            <div>
                                <h3 class="text-lg font-semibold text-yellow-800">Batas Waktu Pengumpulan</h3>
                                <div class="mt-2">
                                    <input type="datetime-local" id="deadlineInput" class="w-full md:w-1/2 p-2 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500 disabled:bg-gray-100 disabled:cursor-not-allowed">
                                    <p class="text-xs text-gray-500 mt-1">Guru dapat mengubah batas waktu.</p>
                                </div>
                            </div>
                            
                            <!-- Komentar Guru -->
                            <div>
                                <h3 class="text-lg font-semibold text-yellow-800">Komentar & Feedback Guru</h3>
                                <textarea id="komentarGuru" rows="5" class="mt-2 w-full p-3 border border-gray-300 rounded-md focus:ring-yellow-500 focus:border-yellow-500 disabled:bg-gray-100" placeholder="Guru akan memberikan feedback di sini..."></textarea>
                                 <p class="text-xs text-gray-500 mt-1">Hanya guru yang dapat mengisi komentar ini.</p>
                            </div>

                            <!-- Rekapitulasi Pengumpulan -->
                            <div>
                                <h2 class="text-xl font-semibold mb-4 text-yellow-800 border-b pb-2">Rekapitulasi Pengumpulan Tugas</h2>
                                <div class="overflow-x-auto mt-4">
                                    <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                                        <thead class="bg-yellow-100">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-yellow-800 uppercase tracking-wider">Nama Siswa</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-yellow-800 uppercase tracking-wider">Kelas</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-yellow-800 uppercase tracking-wider">Mata Pelajaran</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-yellow-800 uppercase tracking-wider">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="rekapTabelBody" class="divide-y divide-gray-200">
                                            <!-- Data rekap akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            <footer class="text-center mt-4 text-sm text-gray-500">
                <p>Dibuat dengan ❤️ untuk Pendidikan</p>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- ELEMEN DOM ---
            const loginPage = document.getElementById('loginPage');
            const appContainer = document.getElementById('appContainer');
            const loginRole = document.getElementById('loginRole');
            const guruLoginSection = document.getElementById('guruLoginSection');
            const namaGuru = document.getElementById('namaGuru');
            const guruLoginError = document.getElementById('guruLoginError');
            const loginButton = document.getElementById('loginButton');
            
            const userRoleSelect = document.getElementById('userRole');
            const page1 = document.getElementById('page1');
            const page2 = document.getElementById('page2');
            const navPage1 = document.getElementById('navPage1');
            const navPage2 = document.getElementById('navPage2');
            const formContainer = document.getElementById('formContainer');
            const deadlineMessage = document.getElementById('deadlineMessage');
            const submissionForm = document.getElementById('submissionForm');
            const deadlineInput = document.getElementById('deadlineInput');
            const komentarGuru = document.getElementById('komentarGuru');
            const rekapTabelBody = document.getElementById('rekapTabelBody');
            const fileInput = document.getElementById('fileTugas');
            const fileNameSpan = document.getElementById('fileName');

            // --- DATA APLIKASI (STATE) ---
            const daftarGuru = ['Meli', 'Udin', 'Ratna', 'Surya'];
            let daftarSiswa = [
                { id: 1, nama: 'Budi Santoso', kelas: '10A', mapel: 'Matematika', sudahMengumpulkan: false },
                { id: 2, nama: 'Ani Yudhoyono', kelas: '10A', mapel: 'Matematika', sudahMengumpulkan: false },
                { id: 3, nama: 'Citra Lestari', kelas: '10B', mapel: 'Fisika', sudahMengumpulkan: false },
            ];
            
            // --- FUNGSI-FUNGSI ---

            function navigateTo(pageId) {
                page1.classList.add('hidden');
                page2.classList.add('hidden');
                navPage1.classList.remove('active');
                navPage2.classList.remove('active');

                if (pageId === 'page1') {
                    page1.classList.remove('hidden');
                    navPage1.classList.add('active');
                } else {
                    page2.classList.remove('hidden');
                    navPage2.classList.add('active');
                }
            }

            function renderTabel() {
                rekapTabelBody.innerHTML = '';
                daftarSiswa.forEach(siswa => {
                    const row = document.createElement('tr');
                    const statusClass = siswa.sudahMengumpulkan ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                    const statusText = siswa.sudahMengumpulkan ? 'Sudah Mengumpulkan' : 'Belum Mengumpulkan';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">${siswa.nama}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${siswa.kelas}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${siswa.mapel}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                    `;
                    rekapTabelBody.appendChild(row);
                });
            }

            function isDeadlinePassed() {
                return new Date() > new Date(deadlineInput.value);
            }

            function updateUI() {
                const role = userRoleSelect.value;
                const deadlinePassed = isDeadlinePassed();

                deadlineInput.disabled = role !== 'guru';
                komentarGuru.disabled = role !== 'guru';

                if (role === 'siswa') {
                    navigateTo('page1');
                } else {
                    navigateTo('page2');
                }

                if (deadlinePassed) {
                    formContainer.style.display = 'none';
                    deadlineMessage.style.display = 'block';
                } else {
                    formContainer.style.display = 'block';
                    deadlineMessage.style.display = 'none';
                }
            }
            
            // --- EVENT LISTENERS ---
            
            loginRole.addEventListener('change', function() {
                if (this.value === 'guru') {
                    guruLoginSection.classList.remove('hidden');
                } else {
                    guruLoginSection.classList.add('hidden');
                    guruLoginError.classList.add('hidden');
                }
            });

            loginButton.addEventListener('click', function() {
                const role = loginRole.value;
                guruLoginError.classList.add('hidden');

                if (role === 'siswa') {
                    loginPage.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    userRoleSelect.value = 'siswa';
                    initApp();
                } else {
                    const guruName = namaGuru.value.trim();
                    const isValidGuru = daftarGuru.some(g => g.toLowerCase() === guruName.toLowerCase());

                    if (isValidGuru) {
                        loginPage.classList.add('hidden');
                        appContainer.classList.remove('hidden');
                        userRoleSelect.value = 'guru';
                        initApp();
                    } else {
                        guruLoginError.classList.remove('hidden');
                    }
                }
            });

            navPage1.addEventListener('click', () => navigateTo('page1'));
            navPage2.addEventListener('click', () => navigateTo('page2'));

            submissionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (isDeadlinePassed()) {
                    alert('Batas waktu sudah habis!');
                    updateUI();
                    return;
                }

                const nama = document.getElementById('namaSiswa').value;
                const kelas = document.getElementById('kelas').value;
                const siswa = daftarSiswa.find(s => s.nama.toLowerCase() === nama.toLowerCase() && s.kelas.toLowerCase() === kelas.toLowerCase());

                if (siswa) {
                    if(siswa.sudahMengumpulkan){
                        alert('Anda sudah pernah mengumpulkan tugas ini!');
                        return;
                    }
                    siswa.sudahMengumpulkan = true;
                } else {
                    const newSiswa = {
                        id: daftarSiswa.length + 1,
                        nama: nama,
                        kelas: kelas,
                        mapel: document.getElementById('mapel').value,
                        sudahMengumpulkan: true
                    };
                    daftarSiswa.push(newSiswa);
                }
                renderTabel();
                alert('Tugas berhasil dikumpulkan!');
                submissionForm.reset();
                fileNameSpan.textContent = 'Belum ada file dipilih';
            });
            
            fileInput.addEventListener('change', function() {
                fileNameSpan.textContent = this.files.length > 0 ? this.files[0].name : 'Belum ada file dipilih';
            });
            
            deadlineInput.addEventListener('change', function() {
                if(userRoleSelect.value === 'guru' && !isNaN(new Date(this.value))) {
                    console.log('Deadline diubah menjadi: ', this.value);
                    alert('Batas waktu berhasil diperbarui.');
                }
            });

            // --- INISIALISASI APLIKASI ---
            function initApp() {
                const deadline = new Date();
                deadline.setDate(deadline.getDate() + 3);
                const formattedDeadline = deadline.getFullYear() + '-' +
                    ('0' + (deadline.getMonth() + 1)).slice(-2) + '-' +
                    ('0' + deadline.getDate()).slice(-2) + 'T' +
                    ('0' + deadline.getHours()).slice(-2) + ':' +
                    ('0' + deadline.getMinutes()).slice(-2);
                deadlineInput.value = formattedDeadline;
                
                renderTabel();
                updateUI();
            }
        });
    </script>
</body>
</html>